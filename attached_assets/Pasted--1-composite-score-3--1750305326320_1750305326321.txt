# Ğ‘Ğ»Ğ¾Ğº 1. ĞĞ²Ñ‚Ğ¾-Ğ¾Ñ€Ğ´ĞµÑ€ Ğ¿Ñ€Ğ¸ composite-score â‰¥ 3
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 0) ĞŸÑ€ĞµĞ´Ğ¿Ğ¾ÑÑ‹Ğ»ĞºĞ¸
#    â€¢ Ğ² signals/composite.py ÑƒĞ¶Ğµ ĞµÑÑ‚ÑŒ   get_composite_score(figi)  â†’ int
#    â€¢ sandbox TOKEN Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½, Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° log_trade â†’ webhook ÑƒĞ¶Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
#
# 1. Ğ¡ĞĞ—Ğ”ĞĞ¢Ğ¬  trade/auto.py
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# import os, datetime as dt, traceback, tinkoff.invest as ti
# from signals.composite import get_composite_score
# from trade.logger  import log_trade      # (<- Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ ÑˆĞ»Ñ‘Ñ‚ Ğ² Google-Sheet)
#
# ACCOUNT = os.getenv("TKS_SANDBOX_ACC")         # Ğ¿Ğ¾ÑĞ»Ğµ setup_sandbox.py
# TOKEN   = os.getenv("TINKOFF_SANDBOX_TOKEN")
# AUTO_ON = os.getenv("AUTO_TRADE","0") == "1"
#
# FIX_QTY = int(os.getenv("AUTO_QTY","1"))       # Ğ¿Ğ¾ 1 Ğ»Ğ¾Ñ‚Ñƒ Ğ½Ğ° ÑĞ¸Ğ³Ğ½Ğ°Ğ»
#
# def auto_trade(figi:str, price_rub:float, ticker:str):
#     if not AUTO_ON:
#         return False, "auto-off"
#
#     score = get_composite_score(figi)
#     if abs(score) < 3:
#         return False, "score<3"
#
#     side  = ti.LimitOrderRequest.LimitOrderDirection.BUY if score > 0 else ti.LimitOrderRequest.LimitOrderDirection.SELL
#
#     try:
#         with ti.Client(TOKEN, app_name="auto-trade") as c:
#             resp = c.sandbox.post_sandbox_order(
#                 account_id = ACCOUNT,
#                 figi       = figi,
#                 price      = ti.Quotation(units=int(price_rub), nano=0),
#                 quantity   = FIX_QTY,
#                 direction  = side,
#                 order_type = ti.OrderType.OPERATION_TYPE_LIMIT,
#                 order_id   = f"auto-{dt.datetime.utcnow().timestamp():.0f}"
#             )
#         # Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ² Sheet
#         log_trade(
#             date = dt.date.today().isoformat(),
#             ticker = ticker,
#             figi   = figi,
#             side   = "BUY" if score>0 else "SELL",
#             price  = price_rub,
#             qty    = FIX_QTY,
#             fees   = 0.0
#         )
#         return True, f"orderId {resp.order_id}"
#     except Exception as e:
#         traceback.print_exc()
#         return False, str(e)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
# 2. Ğ’ daily_plan_bot.py (Ğ¸Ğ»Ğ¸ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ½Ğ¾Ğ¹ Ğ´Ğ¶Ğ¾Ğ±Ğµ, Ğ³Ğ´Ğµ ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑÑ Ğ´Ğ½ĞµĞ²Ğ½Ğ¾Ğ¹ Ğ¿Ğ»Ğ°Ğ½)
#    â€¢ Ğ¿Ğ¾ÑĞ»Ğµ Ñ‚Ğ¾Ğ³Ğ¾ ĞºĞ°Ğº Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚Ğµ   price_list[ticker] = last_price
#      Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ:
#        from trade.auto import auto_trade
#        ok,msg = auto_trade(figi, last_price, ticker)
#        if ok:
#            plan_lines.append(f"ğŸ’° {ticker}: Ğ°Ğ²Ñ‚Ğ¾-{msg}")
#
# 3. Secrets / .env
#    AUTO_TRADE=1          # Ğ²ĞºĞ» / Ğ²Ñ‹ĞºĞ»
#    AUTO_QTY=1            # ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ»Ğ¾Ñ‚Ğ¾Ğ² Ğ½Ğ° ÑĞ¸Ğ³Ğ½Ğ°Ğ»
#    TKS_SANDBOX_ACC=<uuid Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°>  # Ğ¸Ğ· setup_sandbox.py
#
# 4. ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ³Ğ¾ Ğ½Ğµ Ğ¼ĞµĞ½ÑÑ‚ÑŒ.  Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Ğ¿ĞµÑĞ¾Ñ‡Ğ½Ğ¸Ñ†Ğµ!
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# DONE