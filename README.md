# Tinkoff Invest Sandbox Setup

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Å–æ—á–Ω–æ–≥–æ —Å—á—ë—Ç–∞ –≤ Tinkoff Invest API.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–ª—è –ø–µ—Å–æ—á–Ω–∏—Ü—ã –Ω–∞ [developers.tinkoff.ru](https://developers.tinkoff.ru/)

2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ –Ω–µ–≥–æ –≤–∞—à —Ç–æ–∫–µ–Ω:
```
TINKOFF_SANDBOX_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

## –ó–∞–ø—É—Å–∫

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Å–æ—á–Ω–æ–≥–æ —Å—á—ë—Ç–∞

–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Å–æ—á–Ω–æ–≥–æ —Å—á—ë—Ç–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
python setup_sandbox.py
```

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –û—Ç–∫—Ä–æ–∏—Ç –Ω–æ–≤—ã–π –ø–µ—Å–æ—á–Ω—ã–π —Å—á—ë—Ç (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
- –ü–æ–ø–æ–ª–Ω–∏—Ç —Å—á—ë—Ç –Ω–∞ 100 000 ‚ÇΩ
- –í—ã–≤–µ–¥–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –ø–æ—Ä—Ç—Ñ–µ–ª—è

### –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

–î–ª—è –∑–∞–ø—É—Å–∫–∞ Telegram-–±–æ—Ç–∞ —Å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–º –ø–ª–∞–Ω–æ–º:

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –≤ —Ñ–∞–π–ª–µ `.env`:
```
TINKOFF_SANDBOX_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_—Ç–∏–Ω—å–∫–æ—Ñ—Ñ
TELEGRAM_TOKEN=–≤–∞—à_telegram_bot_token
TELEGRAM_CHAT_ID=–≤–∞—à_chat_id
SHEETS_WEBHOOK_URL=–≤–∞—à_google_sheets_webhook_url
SHEETS_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–¥–ª—è_sheets
```

2. **–ü–æ–ª—É—á–∏—Ç–µ Telegram —Ç–æ–∫–µ–Ω:**
   - –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram
   - –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π `/newbot`
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

3. **–£–∑–Ω–∞–π—Ç–µ Chat ID:**
   - –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ: `https://api.telegram.org/bot<–í–ê–®_–¢–û–ö–ï–ù>/getUpdates`
   - –ù–∞–π–¥–∏—Ç–µ `"chat":{"id":–ß–ò–°–õ–û}` - —ç—Ç–æ –≤–∞—à Chat ID

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
```bash
python daily_plan_bot.py bot
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
python daily_plan_bot.py bot
```

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

üîç **–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π:**
- NewsAPI (–ø–ª–∞—Ç–Ω—ã–π, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏)
- RSS –ª–µ–Ω—Ç—ã (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ, –±—ã—Å—Ç—Ä—ã–µ)
- GDELT Project (–≥–ª–æ–±–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –Ω–æ–≤–æ—Å—Ç–µ–π)

üîß **GDELT –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á—ë–Ω (ENV GDELT_OFF=1). –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ NewsAPI –∏ RSS.**

## üîç GDELT Connectivity Check

–î–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ GDELT API –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

### –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bash
./run_gdelt_diag.sh
```

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
# –¢–æ–ª—å–∫–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
python -m tools.gdelt_diag

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã
python -m pytest tests/test_gdelt_diag.py -v
```

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:
- **Ping test**: –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API endpoint
- **Latency**: –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞
- **Search test**: –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- **JSON parsing**: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
- ‚úÖ **OK** - GDELT API —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚è∞ **Timeout** - –ø—Ä–æ–±–ª–µ–º—ã —Å–µ—Ç–∏ –∏–ª–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ API
- üåê **Connection Error** - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞
- ‚ùå **HTTP Error** - –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ GDELT

–ï—Å–ª–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã, –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ NewsAPI + RSS –∏—Å—Ç–æ—á–Ω–∏–∫–∏.

–ë–æ—Ç –ø–æ–ª—É—á–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –∞–∫—Ü–∏–π YNDX –∏ FXIT, –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç –∏—Ö –≤ Telegram –∏–ª–∏ –≤—ã–≤–µ–¥–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å (–µ—Å–ª–∏ Telegram –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω).

## –°–∏–≥–Ω–∞–ª—ã

### SMA Breakout

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä **SMA Breakout**, –∫–æ—Ç–æ—Ä—ã–π –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å–∫–æ–ª—å–∑—è—â–∏—Ö —Å—Ä–µ–¥–Ω–∏—Ö:

- **SMA20** ‚Äî –ø—Ä–æ—Å—Ç–∞—è —Å–∫–æ–ª—å–∑—è—â–∞—è —Å—Ä–µ–¥–Ω—è—è –∑–∞ 20 –ø–µ—Ä–∏–æ–¥–æ–≤
- **SMA50** ‚Äî –ø—Ä–æ—Å—Ç–∞—è —Å–∫–æ–ª—å–∑—è—â–∞—è —Å—Ä–µ–¥–Ω—è—è –∑–∞ 50 –ø–µ—Ä–∏–æ–¥–æ–≤

**–õ–æ–≥–∏–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤:**
- **BUY** ‚Äî SMA20 –ø–µ—Ä–µ—Å–µ–∫–ª–∞ SMA50 —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–≤–µ—á–µ (–≤–æ—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥)
- **SELL** ‚Äî SMA20 –ø–µ—Ä–µ—Å–µ–∫–ª–∞ SMA50 —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–≤–µ—á–µ (–Ω–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥)  
- **HOLD** ‚Äî –Ω–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö

–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –Ω–∞ —á–∞—Å–æ–≤—ã—Ö —Å–≤–µ—á–∞—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 200 –ø–µ—Ä–∏–æ–¥–æ–≤.

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –≤ Google Sheets

–ë–æ—Ç –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –≤ Google Sheets –¥–ª—è –≤–µ–¥–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ —Å–¥–µ–ª–æ–∫.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

1. –°–æ–∑–¥–∞–π—Ç–µ Google Apps Script —Å webhook –¥–ª—è –ø—Ä–∏–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
2. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:
```
SHEETS_WEBHOOK_URL=https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec
SHEETS_TOKEN=–≤–∞—à_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_—Ç–æ–∫–µ–Ω
```

**–§—É–Ω–∫—Ü–∏–∏:**
- `log_trade()` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–¥–µ–ª–æ–∫
- `log_signal_trade()` ‚Äî —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∏–≥–Ω–∞–ª–æ–≤ –±–æ—Ç–∞
- `test_sheets_connection()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
python trade_logger.py
```

### –ö–æ–º–∞–Ω–¥–∞ `/signals`

–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

```
/signals [fast] [slow] [ATR]
```

- `fast`, `slow` ‚Äî –ø–µ—Ä–∏–æ–¥—ã SMA, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20/50
- `ATR` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, 1.0 = —Å—Ä–µ–¥–Ω–∏–π ATR

**–ü—Ä–∏–º–µ—Ä—ã:**
- `/signals` ‚Äî SMA20/50, ATR‚â•1.0 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `/signals 10 40` ‚Äî SMA10/40, ATR‚â•1.0
- `/signals 10 40 1.2` ‚Äî SMA10/40, ATR‚â•1.2 (–≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å)

### –ö–æ–º–∞–Ω–¥–∞ `/ideas`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –∏–¥–µ–∏, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏ –∞–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π:

```
/ideas [fast] [slow] [ATR]
```

- `fast`, `slow` ‚Äî –ø–µ—Ä–∏–æ–¥—ã SMA –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5/15)
- `ATR` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–∏–≥–Ω–∞–ª:** BUY = +1, SELL = -1, HOLD = 0
2. **–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π:** –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ = +1, –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ = -1, –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ = 0
3. **–ò—Ç–æ–≥–æ–≤—ã–π —Å–∫–æ—Ä:** Technical + Sentiment
4. **–§–∏–ª—å—Ç—Ä:** –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –±—É–º–∞–≥–∏ —Å |—Å–∫–æ—Ä| ‚â• 2

**–ü—Ä–∏–º–µ—Ä—ã:**
- `/ideas` ‚Äî SMA5/15, ATR‚â•0 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `/ideas 10 30 1.0` ‚Äî SMA10/30, ATR‚â•1.0 (–≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å)

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```
üí° –ö–æ–º–ø–æ–∑–∏—Ç-–∏–¥–µ–∏ SMA5/15 ATR‚â•0:
‚Ä¢ YNDX   LONG (score 2)
‚Ä¢ FXIT   SHORT (score -2)
```

### –ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è

```
üìà –ü–ª–∞–Ω –Ω–∞ 2025-06-12
‚Ä¢ YNDX: 2 510,35 ‚ÇΩ
  Signal: BUY
‚Ä¢ FXIT: 120,45 ‚ÇΩ
  Signal: HOLD